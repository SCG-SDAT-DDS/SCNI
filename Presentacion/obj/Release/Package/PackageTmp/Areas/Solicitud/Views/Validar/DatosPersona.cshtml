@using Datos
@using Datos.Recursos
@using Sistema
@using Sistema.Extensiones
@model Datos.DTO.Infraestructura.ViewModels.ValidacionViewModel

@{
    ViewBag.Title = "Datos Persona";
    Layout = "~/Views/Shared/Layouts/_Layout.cshtml";
}
<link rel="stylesheet" href="~/Content/css/plugins/blueimp/css/blueimp-gallery.min.css" />


<div class="ibox bx-s">
    <div class="ibox-title bg-f">
        <h3>Datos Persona</h3>
    </div>
    <div class="ibox-content p-l-20 p-r-10 bg-f br-c">
        <div class="row ">
            <div class="col-sm-12 ">
                <div class="col-sm-6 ">
                    <ul class="list-group clear-list">
                        <li class="list-group-item fist-item">
                            <strong>NOMBRE</strong>
                            <span class="pull-right">@Model.Solicitud.Persona.Nombre</span>
                            <input type="hidden" id="Model_IDPersona" value="@Model.Solicitud.Persona.IDPersona" />
                        </li>
                        <li class="list-group-item">
                            <strong>PRIMER APELLIDO</strong>
                            <span class="pull-right">@Model.Solicitud.Persona.ApellidoP</span>
                        </li>
                        <li class="list-group-item">
                            <strong>SEGUNDO APELLIDO</strong>
                            <span class="pull-right">@Model.Solicitud.Persona.ApellidoM</span>
                        </li>
                        <li class="list-group-item">
                            <strong>GÉNERO</strong>
                            <span class="pull-right">
                                @(Model.Solicitud.Persona.Genero.Contains("1") ? "Femenino" : "Masculino")
                            </span>
                        </li>
                        <li class="list-group-item">
                            <strong>FECHA NACIMIENTO</strong>
                            <span class="pull-right">@(Model.Solicitud.Persona.FechaNacimiento?.ToString("dd/MM/yyyy") ?? string.Empty)</span>
                        </li>
                        <li class="list-group-item">
                            <strong>RFC</strong>
                            <span class="pull-right">@Model.Solicitud.Persona.RFC</span>
                        </li>
                        <li class="list-group-item">
                            <strong>FOLIO DE PAGO</strong>
                            <span class="pull-right">@Model.Solicitud.FolioPago</span>
                        </li>
                        <li class="list-group-item">
                            <strong>CORREO ELECTRÓNICO</strong>
                            <span class="pull-right">@Model.Solicitud.Persona.CorreoElectronico</span>
                        </li>
                        @if (Model.Solicitud.Cancelada)
                        {
                            <li class="list-group-item">
                                <strong>Motivo cancelación</strong>
                                <span class="pull-right">@Model.Solicitud.MotivoCancelacion</span>
                            </li>
                        }
                    </ul>
                </div>
                <div class="col-sm-6 ">
                    <ul class="list-group clear-list">
                        <li class="list-group-item">
                            <strong>CURP</strong>
                            <span class="pull-right">@(Model.Solicitud.Persona.CURP)</span>
                        </li>
                        <li class="list-group-item">
                            <strong>MUNICIPIO</strong>
                            <span class="pull-right">@Model.Solicitud.Persona.Municipio.Nombre</span>
                        </li>
                        <li class="list-group-item">
                            <strong>ESTADO</strong>
                            <span class="pull-right">@Model.Solicitud.Persona.Municipio.Estado.Nombre</span>
                        </li>
                        <li class="list-group-item">
                            <strong>DOCUMENTOS</strong>
                            <div class="scroll_content around-xs">
                                <div class="col-xs-2 p-all-0">
                                    <div class="lightBoxGallery col-xs-12 p-all-0 m-b-0 height">
                                        @if (Model.Solicitud.URLPapeleta != null && Model.Solicitud.URLPapeleta.ToLower().EndsWith(".pdf"))
                                        {
                                            <a href="@(VaribalesWebconfig.UrlDocumentosSolicitante + Model.Solicitud.URLPapeleta)" target="_blank" title="Papeleta de Pago">
                                                <i class="fa fa-file-pdf-o" aria-hidden="true"></i>
                                            </a>
                                        }
                                        else if (Model.Solicitud.URLPapeleta != null)
                                        {
                                            <a href="@(VaribalesWebconfig.UrlDocumentosSolicitante + Model.Solicitud.URLPapeleta)" data-toggle="lightbox" data-title="Vista previa" data-gallery="hidden-images" data-type="image" class="thumbnail col-xs-12 m-b-0 height-100per" title="Papeleta de Pago">
                                                <i class="fa fa-file-pdf-o" aria-hidden="true"></i>
                                            </a>
                                        }
                                    </div>
                                </div>
                                <div class="col-xs-2 p-all-0 m-l-5 max-w">
                                    @if (Model.Solicitud.URLIdentificacion != null)
                                    {
                                        <div class="lightBoxGallery col-xs-12 p-all-0 m-b-0 height">
                                            <a href="@(VaribalesWebconfig.UrlDocumentosSolicitante + Model.Solicitud.URLIdentificacion)" data-toggle="lightbox" data-title="Vista previa" data-gallery="hidden-images" data-type="image" class="thumbnail col-xs-12 m-b-0 height-100per" title="Identificación">
                                                <i class="fa fa-id-card" aria-hidden="true"></i>
                                            </a>
                                        </div>
                                    }
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
                <div class="col-sm-12 text-right">
                    <a href="@Url.Action("Index","EditPersona",  new {Area = "Solicitud", IdSolicitud =  Model.Solicitud.IDSolicitud.ToString().EncodeTo64()})" class="btn btn-warning">
                        <i class="fa fa-pencil"></i>
                        Modificar datos
                    </a>
                    
                    @*<a href="@Url.Action("Index", "Registro", new {Area = "Solicitud", IdSolicitud = Model.Solicitud.IDSolicitud.ToString().EncodeTo64()})" class="btn btn-warning">
                        <i class="fa fa-pencil"></i>
                        Modificar datos
                    </a>*@
                </div>
            </div>
        </div>
    </div>
</div>
@using (Html.BeginForm()) {
<div class="ibox bx-s">
    <div class="ibox-title bg-f ">
        <h3>Buscador</h3>
    </div>
    <div class="ibox-content bg-f">
        <div class="row ">
            <div class="col-xs-12 p-all-0">
                <div class="col-sm-8">
                    <div class="col-xs-12 p-all-0 form-horizontal">
                        <div class="form-group">
                            <div class="col-md-2 col-xs-12">
                                <label for="Persona_Nombre"> Nombre</label>
                            </div>
                            <div class="col-md-10 col-xs-12">
                                @Html.TextBoxFor(s => s.Persona.Nombre, new { @class = "form-control input-sm uppercase", @onkeypress = "return soloLetras(event)" })
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-sm-8">
                    <div class="col-xs-12 p-all-0 form-horizontal">
                        <div class="form-group">
                            <div class="col-md-2 col-xs-12">
                                <label for="Persona_RFC">RFC</label>
                            </div>
                            <div class="col-md-10 col-xs-12">
                                @Html.TextBoxFor(s => s.Persona.RFC, new { @class = "form-control input-sm uppercase",@maxlength= 13 })
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xs-12 text-right">
                    <button type="button" id="btn_AsignarSancionFederal" class="btn btn-default">Asignar sanción federal</button>
                    <button type="submit" class="btn btn-primary" onclick="agregarSancion();">Buscar</button>
                </div>
            </div>

            <div class="col-xs-12 m-t-50">
                <h4>Resultados de la búsqueda</h4>
                <div class="table-responsive">
                    <table class="table table-bordered table-hover table-striped " id="tblBusqueda">
                        <thead>
                        <tr class="center-xs">
                            <th>Número de Expediente</th>
                            <th>Sanción</th>
                            <th>Año</th>
                            <th>Nombre</th>
                            <th>Dependencia-Entidad</th>
                            <th class="text-center">@General.Acciones</th>
                        </tr>
                        </thead>
                        <tbody>
                            @foreach (var sancion in Model.Sanciones)
                            {
                                <tr class="center-xs">
                                    <td>@sancion.NumeroExpediente</td>
                                    <td>@Listas.ObtenerValorDeLista(Listas.ObtenerListaSancionesFederal(), sancion.TipoSancion)</td>
                                    <td>@sancion.Año</td>
                                    <td>
                                        @sancion.Persona.ApellidoP&nbsp;
                                        @sancion.Persona.ApellidoM&nbsp;
                                        @sancion.Persona.Nombre
                                    </td>
                                    <td>@sancion.Entidad.Nombre</td>
                                    <td class="text-center">
                                        <button type="button" class="btn btn-xs btn-primary btn-circle" onclick="agregarSancion('@sancion.IDSancion', '@sancion.Persona.IDPersona');">
                                            <i class="fa fa-plus"></i>
                                        </button>
                                    </td>
                                </tr>
                            }
                            
                            @if (Model.Sanciones.Count == 0)
                            {
                                <tr class="text-center">
                                    <td colspan="6">Ninguna sanción encontrada</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
                <div>
                </div>
            </div>

            <div class="col-xs-12 m-t-50">
                <h4>Sanciones seleccionadas</h4>
                <div class="table-responsive">
                    <table class="table table-bordered table-hover table-striped " id="tblResultado">
                        <thead>
                            <tr class="center-xs">
                                <th>Número de Expediente</th>
                                <th>Sanción</th>
                                <th>Año</th>
                                <th>Nombre</th>
                                <th>Dependencia-Entidad</th>
                                <th class="text-center">@General.Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            @for (int i = 0; i < Model.SancionesSeleccion.Count; i++)
                            {
                                <tr class="center-xs">
                                    <td>@Model.SancionesSeleccion[i].NumeroExpediente</td>
                                    <td>@Listas.ObtenerValorDeLista(Listas.ObtenerListaSancionesFederal(), Model.SancionesSeleccion[i].TipoSancion)</td>
                                    <td>@Model.SancionesSeleccion[i].Año</td>
                                    <td>
                                        @Model.SancionesSeleccion[i].Persona.ApellidoP&nbsp;
                                        @Model.SancionesSeleccion[i].Persona.ApellidoM&nbsp;
                                        @Model.SancionesSeleccion[i].Persona.Nombre
                                    </td>
                                    <td>@Model.SancionesSeleccion[i].Entidad.Nombre</td>
                                    <td class="text-center">
                                        <button type="submit" class="btn btn-xs btn-danger btn-circle" onclick="agregarSancion('-@Model.SancionesSeleccion[i].IDSancion', '@Model.SancionesSeleccion[i].Persona.IDPersona');">
                                            <i class="fa fa-times"></i>
                                        </button>
                                        @Html.Hidden("SancionesSeleccion[" + i + "].IDSancion", Model.SancionesSeleccion[i].IDSancion)
                                    </td>
                                </tr>
                            }
                            @if (Model.SancionesSeleccion.Count == 0)
                            {
                                <tr class="text-center">
                                    <td colspan="6">Ninguna sanción seleccionada</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                    @Html.HiddenFor(m => m.IDSanciones)
                </div>
                <div>
                </div>
            </div>

            <div class="col-xs-12">
                <div class="row end-xs">
                    <div class="col-sm-6">
                        @if (!Model.CartaGenerada)
                        {
                            <button type="submit" id="btn_generar_carta" class="btn btn-xs btn-info"
                                    data-form-action="/Solicitud/Validar/GenerarCarta?idSolicitud=@Request.Params["idSolicitud"]">
                                <i class="fa fa-hand-o-right"></i>Generar Constancia
                            </button>
                        }
                        <button type="button" id="btn_visualizar" class="btn btn-xs btn-success">
                            <i class="fa fa-search"></i>Visualizar Constancia
                        </button>
                        @*<button type="button" id="btn_test" class="btn btn-xs btn-info">Test</button>*@
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
}
<script type="text/javascript" src="~/Content/js/plugins/blueimp/jquery.blueimp-gallery.min.js"></script>

@section Modales
{
    <div id="visualizarCarta" class="modal fade" role="dialog">
        <div class="modal-dialog" style="width: 760px">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Visualizar Carta</h4>
                </div>
                <div class="modal-body">
                    <iframe id="ifCarta" runat="server" width='700px' height='450px' frameborder='0'
                            src=""></iframe>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>
<div id="mdlSancionadoNoCoincide" class="modal fade" role="dialog">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title"><i class="fa fa-warning"></i> Advertencia</h4>
            </div>
            <div class="modal-body">
                Es posible que la sanción no pertenezca al solicitante.
                <br />
                <label>¿Desea asignarla?</label>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
                <button type="button" class="btn btn-primary" id="btn_AsignarSancion">Aceptar</button>
            </div>
        </div>
    </div>
</div>
    <div id="modalSancionFederal" class="modal fade" role="dialog">
    <div class="modal-dialog" style="width: 512px;">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Asignar sanción federal</h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-12 col-xs-12">
                        @* Persona *@
                        <div class="col-md-12 col-xs-12"><h3>Persona</h3></div>
                        <div class="col-md-3 col-xs-12"><label>RFC:</label></div>
                        <div class="col-md-9 col-xs-12 p-t-5">@Model.Persona.RFC</div>
                        <div class="col-md-3 col-xs-12"><label>Nombre:</label></div>
                        <div class="col-md-9 col-xs-12 p-t-5">@Model.Persona.Nombre @Model.Persona.ApellidoP @Model.Persona.ApellidoM</div>
                    </div>
                    <div class="col-md-12 col-xs-12">
                        @* Sanción *@
                        <div class="col-md-12 col-xs-12"><h3>Sanción</h3></div>
                        <div class="col-md-3 col-xs-12"><label>Fecha Ejecutoria</label></div>
                        <div class="col-md-9 col-xs-12">
                            <div class="input-group">
                                @Html.TextBox("txtSancionFederalFechaEjecutoria", "", "{0:dd/MM/yyyy}", new { @class = "form-control input-sm m-t-0", @id = "fecha_ejecutoria", @maxlength = 10 })
                                <label for="fecha_ejecutoria" class="input-group-addon btn"><i class="fa fa-calendar"></i></label>
                            </div>
                        </div>
                        <div class="col-md-12 col-xs-12"></div>
                        <div class="col-md-3 col-xs-12"><label>Tipo:</label></div>
                        <div class="col-md-9 col-xs-12">@Html.DropDownList("ddlSancionFederalTipo", Listas.ObtenerListaSancionesFederal(), new { @id = "ddlSancionFederalTipo", @class = "form-control input-sm" })</div>
                        <div class="col-md-3 col-xs-12"><label>Año:</label></div>
                        <div class="col-md-9 col-xs-12">@Html.DropDownList("ddlSancionFederalAnio", Listas.ObtenerListaAños(false), new { @id = "ddlSancionFederalAnio", @class = "form-control input-sm" })</div>
                        <div id="div_monto" hidden>
                            <div class="col-md-3 col-xs-12"><label>Monto:</label></div>
                            <div class="col-md-9 col-xs-12">@Html.TextBox("txtSancionFederalMonto", string.Empty, new { @class = "form-control input-sm", @maxlength = 13, @onkeypress = "return soloNumeros(event)" })</div>
                        </div>
                        <div id="div_tiempo" hidden>
                            <div class="col-md-3 col-xs-12"><label>Tiempo:</label></div>
                            <div class="col-md-3 col-xs-4">@Html.DropDownList("dllSancionFederalTiempoAnios", Listas.ObtenerListaNumerica(0, 100), new { @class = "form-control input-sm" }) Años</div>
                            <div class="col-md-3 col-xs-4">@Html.DropDownList("dllSancionFederalTiempoMeses", Listas.ObtenerListaNumerica(0, 11), new { @class = "form-control input-sm" }) Meses</div>
                            <div class="col-md-3 col-xs-4">@Html.DropDownList("dllSancionFederalTiempoDias", Listas.ObtenerListaNumerica(0, 364), new { @class = "form-control input-sm" }) Días</div>
                        </div>
                        <div hidden id="div_periodo">
                            <div class="col-md-3 col-xs-12"><label>Fecha Inicial</label></div>
                            <div class="col-md-9 col-xs-12">
                                <div class="input-group">
                                    @Html.TextBox("txtSancionPeriodoInicial", "", "{0:dd/MM/yyyy}", new { @class = "form-control input-sm m-t-0", @id = "txtSancionPeriodoInicial", @maxlength = 10 })
                                    <label for="txtSancionPeriodoInicial" class="input-group-addon btn"><i class="fa fa-calendar"></i></label>
                                </div>
                            </div>
                            <div class="col-md-3 col-xs-12"><label>Fecha Final</label></div>
                            <div class="col-md-9 col-xs-12">
                                <div class="input-group">
                                    @Html.TextBox("txtSancionPeriodoFinal", "", "{0:dd/MM/yyyy}", new { @class = "form-control input-sm m-t-0", @id = "txtSancionPeriodoFinal", @maxlength = 10 })
                                    <label for="txtSancionPeriodoFinal" class="input-group-addon btn"><i class="fa fa-calendar"></i></label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12 col-xs-12 m-t-10">
                        <div id="alertModal"></div>
                    </div>
                </div>
            </div>
            <div class="modal-footer" id="footer1">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
                <button type="button" class="btn btn-primary" id="btn_guardarSancionFederal">Guardar</button>
            </div>
            <div class="modal-footer text-center" id="footer2" style="display: none;">
                <i class="fa fa-spin fa-spinner" style="font-size: 24px;"></i>
            </div>
        </div>
    </div>
</div>
}

@section FooterScripts
{
<script type="text/javascript" src="~/Scripts/plugins/jquery.maskMoney.js"></script>
    <script type="text/javascript" src="/Scripts/jquery.tablesorter.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $("#txtSancionFederalMonto").maskMoney();
            $("#txtSancionFederalMonto").maskMoney('mask');

            $("#tblBusqueda").tablesorter();

            var fechas = [
                $("#fecha_ejecutoria"),
                $("#txtSancionPeriodoInicial"),
                $("#txtSancionPeriodoFinal")
            ];
            var opciones = [1, 'dd/mm/yyyy', true];
            iniciarFechas(fechas, opciones);

            $('.datepicker').css('z-index', 9999);

            $("i.icon-arrow-left").addClass("fa fa-chevron-left");
            $("i.icon-arrow-left").removeClass("icon-arrow-left");
            $("i.icon-arrow-right").addClass("fa fa-chevron-right");
            $("i.icon-arrow-right").removeClass("icon-arrow-right");

            $("#btn_generar_carta").on('click', function (event) {
                var $this = $(this);
                var formAction = $this.attr('data-form-action');
                $this.closest('form').attr('action', formAction);
            });

            $('#btn_visualizar').click(function () {
                $('#ifCarta').attr('height', ($(window).height() - 250) + "px");
                $('#visualizarCarta').modal('show');

                var url = '@(Model.UrlDescargarArchivo + "?idSolicitud=" + Model.Solicitud.IDSolicitud)';

                $('#tblResultado').find('input[type="hidden"]').each(function() {
                    url += "%26idSanciones=" + $(this).val();
                });

                $('#ifCarta').attr('src', "https://docs.google.com/viewer?embedded=true&url=" + url);
            });

            $('#visualizarCarta').on('hidden.bs.modal', function () {
                $('#ifCarta').attr('src', '');
            });

            $('#btn_AsignarSancionFederal').click(function () {
                $("#fecha_ejecutoria").val('');
                $("#ddlSancionFederalTipo").val($("#ddlSancionFederalTipo option:first").val());
                $("#ddlSancionFederalTipo").change();
                $("#ddlSancionFederalAnio").val($("#ddlSancionFederalAnio option:first").val());

                $("#modalSancionFederal").modal("show");
            });

            $("#ddlSancionFederalTipo").on("change", function () {
                switch ($(this).val()) {
                    case "@((byte)TiposSancion.SanciónEconómica)":
                        $('#div_monto').fadeIn();
                        $("#div_tiempo").fadeOut();
                        $("#div_periodo").fadeOut();
                        break;
                    case "@((byte)TiposSancion.Suspensión)":
                        $('#div_tiempo').fadeIn();
                        $("#div_monto").fadeOut();
                        $("#div_periodo").fadeOut();
                        break;
                    case "@((byte)TiposSancion.InhabilitaciónDesempeñar)":
                    case "@((byte)TiposSancion.InhabilitaciónParticipar)":
                        $('#div_tiempo').fadeIn();
                        $("#div_monto").fadeOut();
                        $("#div_periodo").fadeIn();
                        break;
                    default:
                        $("#div_tiempo").fadeOut();
                        $("#div_monto").fadeOut();
                        $("#div_periodo").fadeOut();
                        break;
                }

                $("#txtSancionFederalMonto").val("");
                $("#dllSancionFederalTiempoAnios").val('0');
                $("#dllSancionFederalTiempoMeses").val('0');
                $("#dllSancionFederalTiempoDias").val('0');
            });

            $("#btn_guardarSancionFederal").on("click", function () {
                var valido = 0;

                valido += ValidarControl($("#ddlSancionFederalTipo")) ? 0 : 1;
                valido += ValidarControl($("#fecha_ejecutoria")) ? 0 : 1;

                if ($("#txtSancionFederalMonto").is(':visible')) {
                    valido += ValidarControl($("#txtSancionFederalMonto")) ? 0 : 1;
                }

                if ($('#dllSancionFederalTiempoAnios').is(':visible')) {
                    var selectAno = $('#dllSancionFederalTiempoAnios');
                    var selectMes = $('#dllSancionFederalTiempoMeses');
                    var selectDia = $('#dllSancionFederalTiempoDias');

                    if (selectAno.val() === "0" && selectMes.val() === "0" && selectDia.val() === "0") {
                        valido += ValidarControl(selectAno) ? 0 : 1;
                        valido += ValidarControl(selectMes) ? 0 : 1;
                        valido += ValidarControl(selectDia) ? 0 : 1;
                    }
                }

                if ($('#txtSancionPeriodoInicial').is(':visible')) {
                    valido += ValidarControl($("#txtSancionPeriodoInicial")) ? 0 : 1;
                    valido += ValidarControl($("#txtSancionPeriodoFinal")) ? 0 : 1;
                }

                if (valido > 0) {

                    var mensaje = "Los campos marcados en rojo no deben estar vacios.";

                    mostrarAlertDivEspecifico("alertModal", mensaje, "danger", "fa-warning");

                    event.preventDefault();
                    return false;
                }
                else
                {
                    $.ajax({
                        data: "{ tipoSancion: '" + $("#ddlSancionFederalTipo").val() + "', " +
                            "anio: '" + $("#ddlSancionFederalAnio").val() + "', " +
                            "tiempoAnio: '" + $("#dllSancionFederalTiempoAnios").val() + "', " +
                            "tiempoMes: '" + $("#dllSancionFederalTiempoMeses").val() + "', " +
                            "tiempoDia: '" + $("#dllSancionFederalTiempoDias").val() + "', " +
                            "monto: '" + $("#txtSancionFederalMonto").maskMoney('unmasked')[0] + "', " +
                            "idPersona: '" + '@Model.Solicitud.Persona.IDPersona' + "', " +
                            "fechaEjecutoria: '" + $("#fecha_ejecutoria").val() + "', " +
                            "periodoInicial: '" + $("#txtSancionPeriodoInicial").val() + "', " +
                            "periodoFinal: '" + $("#txtSancionPeriodoFinal").val() + "'" +
                        "}",
                        dataType: "json",
                        contentType: "application/json",
                        type: "POST",
                        url: '@Url.Action("AsignarSancionFederal", "Validar", new { area = "Solicitud" })',
                        beforeSend: function () {
                            $("#footer1").hide();
                            $("#footer2").show();
                        },
                        success: function (result) {

                            if (result["IDSancion"] == 0)
                            {
                                var mensaje = "Error al guardar, intentelo mas tarde.";
                                mostrarAlertDivEspecifico("alertModal", mensaje, "danger", "fa-warning");

                                $("#footer2").hide();
                                $("#footer1").show();

                                event.preventDefault();
                                return false;
                            }

                            var cantidadSanciones = $("#tblResultado tbody tr").length;

                            if (cantidadSanciones === 1) {
                                cantidadSanciones = $("#tblResultado tbody tr td").length === 1 ? 0 : 1;
                            }

                            var tr = "";
                            tr += '<tr class="center-xs">';
                            tr += '<td>' + result["NumeroExpediente"] + '</td>';
                            tr += '<td>' + result["Tipo"] + '</td>';
                            tr += '<td>' + result["Anio"] + '</td>';
                            tr += '<td>' + result["NombrePersona"] + '</td>';
                            tr += '<td>' + result["NombreEntidad"] + '</td>';
                            tr += '<td class="text-center">';
                            tr += '<button type = "submit" class="btn btn-xs btn-danger btn-circle" onclick="agregarSancion(\'-' + result["IDSancion"] + '\');">';
                            tr += '<i class="fa fa-times"></i>';
                            tr += '</button>';
                            tr += '<input type="hidden" name="SancionesSeleccion[' + cantidadSanciones + '].IDSancion" value="' + result["IDSancion"] + '"/>';
                            tr += '</td>';
                            tr += '</tr>';

                            if ($("#tblResultado tbody tr:first td:first").text() == "Ninguna sanción seleccionada") {
                                $("#tblResultado tbody").html(tr);
                            } else {
                                $("#tblResultado tbody").append(tr);
                            }

                            $("#modalSancionFederal").modal("hide");

                            $("#footer2").hide();
                            $("#footer1").show();
                        },
                        error: function (error) {

                            var mensaje = "Error al guardar, intentelo mas tarde.";
                            mostrarAlertDivEspecifico("alertModal", mensaje, "danger", "fa-warning");

                            $("#footer2").hide();
                            $("#footer1").show();

                            event.preventDefault();
                            return false;

                        }
                    });
                }
            });

            $("#btn_AsignarSancion").on("click", function () {
                $("form").submit();
            });
        });

        function agregarSancion(id, idP)
        {
            if (id != undefined && idP != undefined)
            {
                var model_id = $("#Model_IDPersona").val();

                $("#IDSanciones").val(id);

                if (model_id != idP && id > 0) {
                    $("#mdlSancionadoNoCoincide").modal("show");
                } else {
                    $("form").submit();
                }
            }
            else
            {
                $("#IDSanciones").val('');
            }
            
        }
    </script>
}